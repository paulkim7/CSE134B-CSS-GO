function readURL(e){if(e.files&&e.files[0]){var t=new FileReader;t.onload=function(e){$("#icon4").attr("src",e.target.result)},t.readAsDataURL(e.files[0]),selectImage("icon4","img4")}}function clickEditHabit(){getUserHabits().then(function(e){var t,n=localStorage.getItem("habitEditID");for(i=0;i<e.length;i++)e[i].id===n&&(t=i);var a=e[t],l=isValidEditHabit(e,t);return l[0]?void updateParseHabit(a).then(function(){alert("Edit success!"),location.href="list.html"})["catch"](function(e){alert(e)}):void alert(l[1])})}function isValidEditHabit(e,t){var n=document.getElementById("title").value,a=document.getElementById("habits").value,l=document.getElementsByName("date[]"),c=document.getElementsByName("day[]"),r=document.getElementById("others").value,o=0,d=0,s=!0,u="";for(""===n&&(u="- Please enter a habit title.\n",s=!1),n.length>=30&&(u+="- Habit title must be under 30 characters.",s=!1),"unselected"===a&&(u+="- Please select an icon image.\n",s=!1),i=0;i<l.length;i++)l[i].checked===!0&&o++;for(0===o&&(u+="- Please select at least ONE day.\n",s=!1),j=0;j<c.length;j++)if(c[j].checked===!0){d++;break}for(0===d&&""===r&&(u+="- Please specify daily frequency of habit.\n",s=!1),0===d&&4>r&&(u+="- Please enter a value greater than 3 for other.\n",s=!1),i=0;i<e.length;i++)e[i].get("title")===n&&i!==t&&(u+="- Habit title already exists, please change.",s=!1);var f=[s,u];return f}function updateParseHabit(e){return new Promise(function(t,n){var a=document.getElementById("title").value,l=document.getElementById("habits").value,c=document.getElementById("habits").selectedIndex,r=document.getElementsByName("date[]"),o=r.length,d=Array();for(k=0;k<o;k++)d[k]=r[k].checked;var s=JSON.stringify(d),u=document.getElementsByName("day[]"),f=u.length,m=Array(),g=0;for(i=0;i<f;i++)m[i]=u[i].checked,u[i].checked===!0&&(g=i+1);0===g&&(g=Number(document.getElementById("others").value));var h=document.getElementById("iconUploaderEdit"),y=!1,p=JSON.parse(e.get("day"));for(i=0;i<p.length;i++)p[i]!==r[i]&&(y=!0);if(4===document.getElementById("habits").selectedIndex&&h.files.length>0)uploadUserIcon(document.getElementById("iconUploaderEdit")).then(function(){(e.get("dailyFreq")!==g||y)&&(e.set("progVal",0),e.set("streak",0),e.set("record",0)),l=document.getElementById("img4").value,(4!==c||h.files.length>0)&&e.set("iconLoc",l),e.set("title",a),e.set("iconNum",c),e.set("day",s),e.set("freq",m),e.set("dailyFreq",g),e.save().then(function(e){t()},function(e){n(e.message)})});else{(e.get("dailyFreq")!==g||y)&&(e.set("progVal",0),e.set("streak",0),e.set("record",0));var h=document.getElementById("iconUploaderEdit");(4!==c||h.files.length>0)&&e.set("iconLoc",l),e.set("title",a),e.set("iconNum",c),e.set("day",s),e.set("freq",m),e.set("dailyFreq",g),e.save().then(function(e){t()},function(e){n(e.message)})}})}function uploadUserIcon(e){return new Promise(function(t,n){var a=e.files[0],i="https://api.parse.com/1/files/"+a.name;$.ajax({type:"POST",beforeSend:function(e){e.setRequestHeader("X-Parse-Application-Id","d2claNl95q01NDPLvJ5c6wss7ePAqKGn9l048Zqb"),e.setRequestHeader("X-Parse-REST-API-Key","F74LnjmLlP0yCRE9wUEyoo0H3T23UWrf9UqZ5eAR"),e.setRequestHeader("Content-Type",a.type)},url:i,data:a,processData:!1,contentType:!1,success:function(e){alert("File available at: "+e.url),document.getElementById("img4").value=e.url,t(0)},error:function(e){var t=jQuery.parseJSON(e);n(t.error)}})})}function validateInputs(){var e=document.getElementById("title").value,t=document.getElementById("habits").value,n=document.getElementsByName("date[]"),a=document.getElementsByName("day[]"),l=document.getElementById("others").value,c=0,r=0,o=!0,d="";for(""===e&&(d="- Please enter a habit title.\n",o=!1),"unselected"===t&&(d+="- Please select an icon image.\n",o=!1),i=0;i<n.length;i++)n[i].checked===!0&&c++;for(0===c&&(d+="- Please select at least ONE day.\n",o=!1),j=0;j<a.length;j++)if(a[j].checked===!0){r++;break}0===r&&""===l&&(d+="- Please specify daily frequency of habit.\n",o=!1),o===!0?checkDuplicateTitle():alert(d)}function checkDuplicateTitle(){for(var e=document.getElementById("title").value,t=JSON.parse(localStorage.getItem("habitList")),n=localStorage.getItem("habitEditID"),a=0;a<t.length;){var i=JSON.parse(t[a]);if(e===i.title&&i.id!=n)return void alert("The following habit title already exists. Please edit the existing habit.");a++}4===document.getElementById("habits").selectedIndex?uploadUserIcon(document.getElementById("iconUploaderEdit")).then(function(){updateHabit()})["catch"](function(e){alert(e)}):updateHabit(e)}$(document).ready(function(){$("#freq1Btn").click(function(){$("#freq1Btn").toggle(),$("#freq2Btn").prop("checked",!1),$("#freq3Btn").prop("checked",!1)}),$("#freq2Btn").click(function(){$("#freq2Btn").toggle(),$("#freq1Btn").prop("checked",!1),$("#freq3Btn").prop("checked",!1)}),$("#freq3Btn").click(function(){$("#freq3Btn").toggle(),$("#freq1Btn").prop("checked",!1),$("#freq2Btn").prop("checked",!1)}),$("#others").click(function(){$("#freq1Btn").prop("checked",!1),$("#freq2Btn").prop("checked",!1),$("#freq3Btn").prop("checked",!1)})});