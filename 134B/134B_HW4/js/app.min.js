function login(e,t){return new Promise(function(n,r){Parse.User.logIn(e,t,{success:function(e){n(e)},error:function(e,t){r(t)}})})}function checkForCacheUser(){var e=Parse.User.current();return e?!0:!1}function logOut(){Parse.User.logOut().then(function(){var e=Parse.User.current();return null===e?(location.href="login.html",!0):!1})}function checkForLogin(){checkForCacheUser()||(alert("You must log in first."),location.href="login.html")}function createUser(e,t){return new Promise(function(n,r){var a=new Parse.User;return isValidEmail(e)?isValidPassword(t)?(a.set("username",e),a.set("password",t),void a.signUp().then(function(e){alert("User account successfully created."),n()},function(e){r(e)})):(alert("Password must contain one capital letter, one number, and must be between 5 and 15 characters"),void r("invalid pass")):(alert("Is invalid email"),void r("invalid email"))})}function validateImageUpload(e){if(-1===e.lastIndexOf("."))return!1;var t,n=e.substring(e.lastIndexOf(".")+1,e.length),r=["jpg","jpeg","png","gif"];for(t=0;t<r.length;++t)if(n===r[t])return!0;return!1}function uploadUserIcon(e){return new Promise(function(t,n){var r=e.files[0],a="https://api.parse.com/1/files/"+r.name;$.ajax({type:"POST",beforeSend:function(e){e.setRequestHeader("X-Parse-Application-Id","d2claNl95q01NDPLvJ5c6wss7ePAqKGn9l048Zqb"),e.setRequestHeader("X-Parse-REST-API-Key","F74LnjmLlP0yCRE9wUEyoo0H3T23UWrf9UqZ5eAR"),e.setRequestHeader("Content-Type",r.type)},url:a,data:r,processData:!1,contentType:!1,success:function(e){document.getElementById("img4").value=e.url,t(0)},error:function(e){var t=jQuery.parseJSON(e);n(t.error)}})})}function isValidHabitInput(e){var t=document.getElementById("title").value,n=document.getElementById("habits").value,r=document.getElementsByName("date[]"),a=document.getElementsByName("day[]"),s=document.getElementById("others").value,o=0,c=0,l=!0,u="";for(""===t&&(u="- Please enter a habit title.\n",l=!1),t.length>=30&&(u+="- Habit title must be under 30 characters.",l=!1),"unselected"===n&&(u+="- Please select an icon image.\n",l=!1),i=0;i<r.length;i++)r[i].checked===!0&&o++;for(0===o&&(u+="- Please select at least ONE day.\n",l=!1),j=0;j<a.length;j++)if(a[j].checked===!0){c++;break}for(0===c&&""===s&&(u+="- Please specify daily frequency of habit.\n",l=!1),0===c&&4>s&&(u+="- Please enter a value greater than 3 for other.\n",l=!1),i=0;i<e.length;i++)if(e[i].get("title")===t){u+="- Habit title already exists, please change.\n",l=!1;break}var d=[l,u];return d}function clickAddHabit(){getUserHabits().then(function(e){var t=isValidHabitInput(e);return t[0]?void createParseHabit().then(function(){alert("Create habit success!"),location.href="list.html"})["catch"](function(e){alert(e)}):void alert(t[1])})}function createParseHabit(){return new Promise(function(e,t){var n=document.getElementById("title").value,r=document.getElementById("habits").value,a=document.getElementById("habits").selectedIndex,s=document.getElementsByName("date[]"),o=s.length,c=Array();for(k=0;k<o;k++)c[k]=s[k].checked;var l=JSON.stringify(c),u=document.getElementsByName("day[]"),d=u.length,f=Array(),m=0;for(i=0;i<d;i++)f[i]=u[i].checked,u[i].checked===!0&&(m=i+1);if(0===m)var m=Number(document.getElementById("others").value);var g=new Date,h=g.getTime(),v=h.toString(),b=n.substring(0,4)+v.substring(v.length-3),y=(b.replace(/ /g,""),0);if(4===document.getElementById("habits").selectedIndex)uploadUserIcon(document.getElementById("iconUploaderAdd")).then(function(){var i=Parse.Object.extend("Habit"),s=new i;r=document.getElementById("img4").value,s.set("title",n),s.set("iconLoc",r),s.set("iconNum",a),s.set("day",l),s.set("freq",f),s.set("progVal",y),s.set("dailyFreq",m),s.set("streak",0),s.set("record",0);var o=Parse.User.current();s.save().then(function(e){var t=o.relation("habits");return t.add(e),o.save()}).then(function(t){e()},function(e){t(e.message)})});else{var P=Parse.Object.extend("Habit"),p=new P;p.set("title",n),p.set("iconLoc",r),p.set("iconNum",a),p.set("day",l),p.set("freq",f),p.set("progVal",y),p.set("dailyFreq",m),p.set("streak",0),p.set("record",0);var I=Parse.User.current();p.save().then(function(e){var t=I.relation("habits");return t.add(e),I.save()}).then(function(t){e()},function(e){t(e.message)})}})}function removeParseHabit(e){return new Promise(function(t,n){var r=Parse.Object.extend("Habit"),a=new Parse.Query(r);a.equalTo("objectId",e),a.find().then(function(e){1!==e.length&&n("Could not find your habit in the table.");var t=e[0];return t.destroy()}).then(function(){t()},function(e){alert(e.message),n()})})}function getUserHabits(){return new Promise(function(e,t){var n=Parse.User.current(),r=n.relation("habits"),a=r.query();a.equalTo("Habit"),r.query().find().then(function(t){e(t)})})}function storeHabitID(e){localStorage.setItem("habitEditID",e)}Parse.initialize("d2claNl95q01NDPLvJ5c6wss7ePAqKGn9l048Zqb","N344LtQrb8LdEIKU1M4dlsMSUZiXf1fEtSY16Of7");